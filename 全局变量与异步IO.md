## 全局变量与异步IO

##### 避免异步I/O的类型

sig_atomic_t 

​	平台下的原子类型

说明：

> 比如我们在32位的 操作系统下，我们定义一个全局变量long long x - 10; 当我们赋值时，汇编会转成两个movl语句，如果在这两个movl语句之间，发生了信号捕捉函数，改变了x的值，那么我们最终赋值的x将什么都不是
>
> 因此，当有信号机制或多线程时，我们应当避免使用非原子类型的数据量



##### volatile 避免编译器优化

编译器会对一些它认为不会改变的变量进行优化，不用频繁地进行IO操作

比如

```c++
int n;
int main{
    while(n)
    {
        i++;
    }
}
```

编译器认为n在循环中没有改变，就不会频繁地去内存中取n，可能只取一次。但如果我们使用异步函数改变了n的值变成0，循环时不回退出的

因此，我们可以使用volatile关键字将变量声明为不可优化的变量

```c++
volatile int n;
```



## 向信号处理函数中传参

使用sigqueue函数

详细看sigqueue和sigaciton，需要将flag设置为SIGINFO



## 信号中断系统调用

不同系统有不同的处理方式（以read为例）

* 返回部分读到的数据
* read返回-1，errno设置为EINTR

