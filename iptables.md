## iptables
内网关闭，外网打开
iptables是一个命令行工具，能和netfilter通信
管理网络
常用功能：做流量转发（在IP层转发，不用在应用层写逻辑）

linux路由表中的网关

一个数据如果想要从内网(192.168.1.12)发往外网如(10.10.10.1)
流程：

一、192.168.1.12的route -n
1) 0.0.0.0 192.168.0.1 0.0.0.0  //默认网关设置在路由器上(192.168.0.1)
2) 192.168.1.0 0.0.0.0 255.255.255.0 

二、根据路由表，将发给外网的包发往路由器
    source_ip = 192.168.1.12, dst_ip = 192.168.0.1
    source_mac = 本机的mac  dsdt_mac = 路由器mac

三、路由器收到了发往外网的包
    dst_mac是不是我？是 pass 
    dst_ip 是不是我？不是，发往默认网关（22.22.22.1）（外网地址）
    将source_ip 换为公网地址22.22.22.1，dst_ip不变（SNAT）
    

路由表+iptables+bridges(网桥/桥接)

kubernets



iptables为我们提供了四种功能表

filter表：负责过滤功能，防火墙；内核模块：iptables_filter

nat表：network address translation，网络地址转换功能；内核模块：iptable_nat

mangle表：拆解报文，做出修改，并重新封装 的功能；iptable_mangle

raw表：关闭nat表上启用的连接追踪机制；iptable_raw



处理动作（target）

基本动作：

* ACCEPT   允许数据包通过

* DROP   丢弃数据包，不给任何回应，客户端会超时后才有反应

* REJECT   拒绝数据包通过，会给数据发送端一个响应信息

* SNAT   源地址转换

* DNAT   目标地址转换

  

**pkts**:对应规则匹配到的报文的个数。

**bytes**:对应匹配到的报文包的大小总和。

**target**:规则对应的target，往往表示规则对应的"动作"，即规则匹配成功后需要采取的措施。

**prot**:表示规则对应的协议，是否只针对某些协议应用此规则。

**opt**:表示规则对应的选项。

**in**:表示数据包由哪个接口(网卡)流入，我们可以设置通过哪块网卡流入的报文需要匹配当前规则。

**out**:表示数据包由哪个接口(网卡)流出，我们可以设置通过哪块网卡流出的报文需要匹配当前规则。

**source**:表示规则对应的源头地址，可以是一个IP，也可以是一个网段。

**destination**:表示规则对应的目标地址。可以是一个IP，也可以是一个网段。